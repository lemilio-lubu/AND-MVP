# Flujo de Usuario - AND MVP

## Diagrama de Flujo Implementado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LANDING PAGE                                 â”‚
â”‚                      (app/landing/page.tsx)                         â”‚
â”‚                                                                      â”‚
â”‚  â€¢ Hero con valor principal: FacturaciÃ³n Local                     â”‚
â”‚  â€¢ Selector: Empresa vs Influencer                                 â”‚
â”‚  â€¢ CTA: "Iniciar SesiÃ³n" / "Registrarse"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                    â”‚
        â–¼                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOGIN PAGE   â”‚                   â”‚ REGISTRO TIPO  â”‚
â”‚               â”‚                   â”‚                â”‚
â”‚ Usuario       â”‚                   â”‚ Â¿Empresa o     â”‚
â”‚ Existente     â”‚                   â”‚ Influencer?    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                    â”‚
        â”‚                                    â–¼
        â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                          â”‚ REGISTRO EMPRESA    â”‚
        â”‚                          â”‚                     â”‚
        â”‚                          â”‚ isNew: true         â”‚
        â”‚                          â”‚ â€¢ Nombre empresa    â”‚
        â”‚                          â”‚ â€¢ Email             â”‚
        â”‚                          â”‚ â€¢ RUC               â”‚
        â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚      USER CONTEXT           â”‚
            â”‚   (lib/context/UserContext) â”‚
            â”‚                             â”‚
            â”‚  â€¢ Login / Logout           â”‚
            â”‚  â€¢ Update User              â”‚
            â”‚  â€¢ Persist LocalStorage     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
         â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
         â•‘         DASHBOARD (CORE)                â•‘
         â•‘     (app/dashboard/page.tsx)            â•‘
         â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                           â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                  â”‚                  â”‚
        â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USUARIO NUEVO â”‚  â”‚   MÃ‰TRICAS   â”‚  â”‚  ACCIONES    â”‚
â”‚               â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ â€¢ GamificaciÃ³nâ”‚  â”‚ â€¢ Total fact.â”‚  â”‚ â€¢ Emitir     â”‚
â”‚   visible     â”‚  â”‚ â€¢ Ahorro     â”‚  â”‚   factura    â”‚
â”‚               â”‚  â”‚ â€¢ Facturas   â”‚  â”‚ â€¢ Ver        â”‚
â”‚ â€¢ Trayectoria:â”‚  â”‚   emitidas   â”‚  â”‚   campaÃ±as   â”‚
â”‚   Iniciando ðŸš€â”‚  â”‚ â€¢ Pendientes â”‚  â”‚              â”‚
â”‚               â”‚  â”‚ â€¢ CampaÃ±as   â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
        â”‚                                    â–¼
        â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                         â”‚ INVOICE MODAL        â”‚
        â”‚                         â”‚                      â”‚
        â”‚                         â”‚ â€¢ Seleccionar        â”‚
        â”‚                         â”‚   campaÃ±a            â”‚
        â”‚                         â”‚ â€¢ Ingresar monto     â”‚
        â”‚                         â”‚ â€¢ Ver cÃ¡lculo        â”‚
        â”‚                         â”‚   tributario         â”‚
        â”‚                         â”‚ â€¢ Validaciones       â”‚
        â”‚                         â”‚                      â”‚
        â”‚                         â”‚ Estados:             â”‚
        â”‚                         â”‚ â†’ Form               â”‚
        â”‚                         â”‚ â†’ Processing         â”‚
        â”‚                         â”‚ â†’ Success / Error    â”‚
        â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                             â”‚
                                             â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   UPDATE USER STATE      â”‚
                              â”‚                          â”‚
                              â”‚ hasEmittedFirstInvoice   â”‚
                              â”‚ = true                   â”‚
                              â”‚                          â”‚
                              â”‚ â†’ Oculta gamificaciÃ³n    â”‚
                              â”‚ â†’ Actualiza mÃ©tricas     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USUARIO EXISTENTE                                â”‚
â”‚                                                                     â”‚
â”‚  âŒ NO ve gamificaciÃ³n inicial                                     â”‚
â”‚  âœ“ Acceso directo a Dashboard de FacturaciÃ³n                      â”‚
â”‚  âœ“ Todas las funcionalidades disponibles                          â”‚
â”‚  âœ“ MÃ©tricas reales visibles                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Validaciones Implementadas

```
ANTES DE EMITIR FACTURA:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¿RUC conectado?         â”‚
â”‚                         â”‚
â”‚  NO â†’ Error + CTA       â”‚
â”‚       "Conectar RUC"    â”‚
â”‚                         â”‚
â”‚  SÃ â†“                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¿CampaÃ±a seleccionada?  â”‚
â”‚                         â”‚
â”‚  NO â†’ Error             â”‚
â”‚                         â”‚
â”‚  SÃ â†“                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¿CampaÃ±a vÃ¡lida?        â”‚
â”‚                         â”‚
â”‚  â€¢ Estado: activa       â”‚
â”‚  â€¢ Budget > 0           â”‚
â”‚  â€¢ isValid: true        â”‚
â”‚                         â”‚
â”‚  NO â†’ Error especÃ­fico  â”‚
â”‚                         â”‚
â”‚  SÃ â†“                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Â¿Monto vÃ¡lido?          â”‚
â”‚                         â”‚
â”‚  â€¢ > 0                  â”‚
â”‚  â€¢ < $1,000,000         â”‚
â”‚  â€¢ !isNaN               â”‚
â”‚                         â”‚
â”‚  NO â†’ Error             â”‚
â”‚                         â”‚
â”‚  SÃ â†“                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    âœ“ EMITIR FACTURA
```

## CÃ¡lculo Tributario

```
MONTO INGRESADO: $10,000
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Base:               $10,000.00
+ IVA (15%):        $ 1,500.00
+ ISD (5%):         $   500.00  â† âŒ EVITADO con facturaciÃ³n local
- No deducible:     $    25.00

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ’³ Tarjeta Internacional:
   $10,000 + $1,500 + $500 + $25 = $12,025.00

ðŸ“„ FacturaciÃ³n Local:
   $10,000 + $1,500 - $25 = $11,475.00

ðŸ’° AHORRO FISCAL: $550.00
```

## Estados de Factura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  draft   â”‚ â† Creada pero no enviada
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ emitida  â”‚ â† Enviada al SRI exitosamente
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pagada  â”‚  â”‚rechazada â”‚  â”‚  draft   â”‚
â”‚          â”‚  â”‚          â”‚  â”‚ (retry)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Arquitectura de Dominio

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               PRESENTACIÃ“N                   â”‚
â”‚                                              â”‚
â”‚  app/                                        â”‚
â”‚  â”œâ”€â”€ dashboard/page.tsx  â† UI               â”‚
â”‚  â”œâ”€â”€ login/page.tsx                         â”‚
â”‚  â””â”€â”€ components/                            â”‚
â”‚      â””â”€â”€ InvoiceEmissionModal.tsx           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ usa
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            LÃ“GICA DE NEGOCIO                 â”‚
â”‚                                              â”‚
â”‚  lib/billing/                                â”‚
â”‚  â”œâ”€â”€ types.ts        â† Definiciones          â”‚
â”‚  â”œâ”€â”€ calculator.ts   â† CÃ¡lculos tributarios  â”‚
â”‚  â””â”€â”€ validation.ts   â† Reglas de negocio    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ESTADO GLOBAL                  â”‚
â”‚                                              â”‚
â”‚  lib/context/                                â”‚
â”‚  â””â”€â”€ UserContext.tsx  â† Estado de usuario    â”‚
â”‚                                              â”‚
â”‚  localStorage  â† Persistencia (mock)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## GamificaciÃ³n Condicional

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  shouldShowGamification(user)      â”‚
â”‚                                    â”‚
â”‚  return user.isNew &&              â”‚
â”‚         !user.hasEmittedFirstInvoiceâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚
    â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ true    â”‚       â”‚  false   â”‚
â”‚         â”‚       â”‚          â”‚
â”‚ Mostrar â”‚       â”‚ Ocultar  â”‚
â”‚ trayec. â”‚       â”‚ gamific. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Niveles:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ðŸš€ Iniciando
   0 facturas emitidas

âš¡ Confianza Comprobada
   < 5 facturas o < $10k

â­ Colaborador Estrella
   < 20 facturas o < $50k

ðŸ¤ Socio EstratÃ©gico
   20+ facturas o $50k+
```
